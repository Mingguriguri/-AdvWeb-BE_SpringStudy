# [강의] w10 - Docker : hello

유형: Lecture
날짜: 2024년 5월 14일
복습 여부: No
상태: 완료

# Create project

- name : docker-hello
- java / gradle
- group: gcu.backend
- jdk: 17 (나는 21로 함)
- java: 17
- dependency
    - spring web
    - 나는 devtools도 추가함

R
![스크린샷 2024-05-14 오후 1.15.34.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.15.34.png)

# Implementation & Build

- Add package controller and create HelloController.java
    
    ![스크린샷 2024-05-14 오후 1.25.34.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.25.34.png)
    

```java
package gcu.backend.dockerhello.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping
public class HelloController {
    @GetMapping("/hello")
    public String getMessage(){
        return "Hello World";
    }
}

```

![스크린샷 2024-05-14 오후 1.26.56.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.26.56.png)

- Run
    - 실행 버튼 누르거나 터미널창에 `./gradlew build` 입력
    
    ![스크린샷 2024-05-14 오후 1.29.43.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.29.43.png)
    
    ![스크린샷 2024-05-14 오후 2.19.58.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.19.58.png)
    

그러면 교수님 자료에 나와있는 것처럼 `libs` 폴더가 생성됨

![스크린샷 2024-05-14 오후 2.21.07.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.21.07.png)

# Create Dockerfile

- docker-hello - right mouse - new - file - dockerfile
    
    ![스크린샷 2024-05-14 오후 1.32.15.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.32.15.png)
    

- write the script of `*Dockerfile*`
    
    ```docker
    FROM openjdk:21
    ARG JAR_FILE=build/libs/*.jar
    COPY ${JAR_FILE} app.jar
    ENTRYPOINT ["java", "-jar", "/app.jar"]
    ```
    
    ![스크린샷 2024-05-14 오후 1.34.21.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.34.21.png)
    

# Create Docker images

- `docker images build -t app` 명령어를 터미널에서 실행한다. (이때 꼭 project안에서 명령을 실행해야 함 (우리 프로젝트는 docker-hello니까 여기서 실행해야 함)
    
    ![스크린샷 2024-05-14 오후 1.42.19.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.42.19.png)
    
    - 그리고 중요한 것! docker desktop 실행해야 함

> **docker image를 build해주는 명령어**
> 
> 
> ```bash
> docker image build -t app .
> ```
> 
> - `-t` 태그: 이름을 설정하고, 이미지에 optionally하게 태그를 붙일 수 있게 하는 명령
> - 마지막에 있는 `.` : 이미지를 빌드하기 위한 Dockerfile과 다른 필수적인 파일을 현재 디렉토리에 위치하도록 설정한ㄷ.

![스크린샷 2024-05-14 오후 2.22.27.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.22.27.png)

잘 실행된 것을 확인할 수 있음.

> `docker images` 이 명령어는 docker image의 목록을 확인할 수 있다.
> 
> 
> ```bash
> docker images
> ```
> 

![스크린샷 2024-05-14 오후 2.22.55.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.22.55.png)

또는 Docker desktop에서 체크할 수 있음!

![스크린샷 2024-05-14 오후 2.05.02.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.05.02.png)

> **docker 실행 명령어**
> 
> 
> ```bash
> docker run - d IMAGE_ID
> ```
> 
> - docker run 명령어는 도커 컨테이너를 실행하는데 사용된다.
> - `-d`는 “detach(분리)”를 의미한다.
> - 그래서 이 명령어는 백그라운드에서 컨테이너를 실행시하고 추가 명령을 위해 터미널을 확보한다.
> - 컨테이너를 실행하려는 도커 이미지 식별 정보로 `IMAGE_ID`를 업데이트한다.

실행시킬 때 `IMAGE_ID`는 중복되는 게 없다면 짧게 입력해도 가능함. 나는 `9c0f8dd9b06e` **를 실행시킬건데 중복되는게 없으니까 73까지만 입력함

![스크린샷 2024-05-14 오후 2.23.32.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.23.32.png)

아니면 docker desktop에서 실행해도 됨

![스크린샷 2024-05-14 오후 2.23.48.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.23.48.png)

![스크린샷 2024-05-14 오후 2.23.55.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.23.55.png)

![스크린샷 2024-05-14 오후 2.24.08.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.24.08.png)

컨테이너 섹션에서도 실행중이라고 뜬다.

![스크린샷 2024-05-14 오후 2.24.19.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.24.19.png)

이제 기본 포트 번호 8080에서 실행 중인 Docker 데스크톱 앱의 로그를 확인해보자

# 에러 발생!!

교수님이 알려주신대로 절차를 밟았지만 이런 화면이 떴다..

![스크린샷 2024-05-14 오후 2.46.23.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.46.23.png)

여기서는 **`docker run`** 명령어에 포트 매핑 옵션을 추가하고, Dockerfile에 포트를 노출하는 코드를 추가

1. **Dockerfile에 포트 노출 ( `EXPOSE 8080` ) 추가하고 저장**
    
    ```docker
    
    FROM openjdk:21
    ARG JAR_FILE=build/libs/*.jar
    COPY ${JAR_FILE} app.jar
    EXPOSE 8080 
    ENTRYPOINT ["java", "-jar", "/app.jar"]
    ```
    
    ![스크린샷 2024-05-14 오후 2.49.36.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.49.36.png)
    
2. 이미지를 다시 빌드:
    
    ```bash
    docker image build -t app .
    ```
    
    ![스크린샷 2024-05-14 오후 2.51.30.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.51.30.png)
    
    ```bash
    docker images
    ```
    
    ![스크린샷 2024-05-14 오후 2.51.54.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.51.54.png)
    
3. **컨테이너 실행:**
    
    ```bash
    docker run -d -p 8080:8080 app
    ```
    
    ![스크린샷 2024-05-14 오후 2.52.28.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.52.28.png)
    
4. 컨테이너 상태 확인:
    
    ```bash
    docker ps
    ```
    
    ![스크린샷 2024-05-14 오후 2.52.36.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.52.36.png)
    

여기서 출력된 컨테이너 목록에 **`0.0.0.0:8080->8080/tcp`**와 같은 항목이 포함되어 있는지 확인한다. 이 항목이 보인다면 Docker 컨테이너가 올바르게 포트를 매핑하고 있는 것!

1. 브라우저에서 확인:
    
    브라우저를 열고 **`http://localhost:8080/hello`**에 접속해서 "Hello World" 메시지가 잘 출력되는지 확인해보기
    
    ![스크린샷 2024-05-14 오후 2.52.54.png](%5B%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%B4%5D%20w10%20-%20Docker%20hello%208b206ca055634ea793272ee39c85f295/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-05-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.52.54.png)
    
    **잘 나오는 것을 확인할 수 있다!!!**
    
    이렇게 `EXPOSE 8080`을 추가해야 한다는 것을 알게 되었다.